"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7382],{3324:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"lens/api/lens-endpoints","title":"LENS API Endpoints","description":"API reference for programmatically interacting with LENS AI features.","source":"@site/docs/lens/api/lens-endpoints.mdx","sourceDirName":"lens/api","slug":"/lens/api/lens-endpoints","permalink":"/lens/api/lens-endpoints","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"LENS API Endpoints","description":"API reference for programmatically interacting with LENS AI features."},"sidebar":"tutorialSidebar","previous":{"title":"Executive Summary","permalink":"/lens/reports/executive-summary"},"next":{"title":"Reports Overview","permalink":"/reports/"}}');var r=s(74848),d=s(28453);const t={sidebar_position:1,title:"LENS API Endpoints",description:"API reference for programmatically interacting with LENS AI features."},l="LENS API Endpoints",c={},a=[{value:"Authentication",id:"authentication",level:2},{value:"Endpoints Overview",id:"endpoints-overview",level:2},{value:"AI Assistant",id:"ai-assistant",level:2},{value:"Send a Question",id:"send-a-question",level:3},{value:"Request Body",id:"request-body",level:4},{value:"Response",id:"response",level:4},{value:"Example",id:"example",level:4},{value:"Anomalies",id:"anomalies",level:2},{value:"List Anomalies",id:"list-anomalies",level:3},{value:"Query Parameters",id:"query-parameters",level:4},{value:"Response",id:"response-1",level:4},{value:"Get Anomaly Details",id:"get-anomaly-details",level:3},{value:"Response",id:"response-2",level:4},{value:"Acknowledge Anomaly",id:"acknowledge-anomaly",level:3},{value:"Request Body",id:"request-body-1",level:4},{value:"Response",id:"response-3",level:4},{value:"Dismiss Anomaly",id:"dismiss-anomaly",level:3},{value:"Request Body",id:"request-body-2",level:4},{value:"Rules",id:"rules",level:2},{value:"List Rules",id:"list-rules",level:3},{value:"Query Parameters",id:"query-parameters-1",level:4},{value:"Response",id:"response-4",level:4},{value:"Create Custom Rule",id:"create-custom-rule",level:3},{value:"Request Body",id:"request-body-3",level:4},{value:"Response",id:"response-5",level:4},{value:"Update Rule",id:"update-rule",level:3},{value:"Request Body",id:"request-body-4",level:4},{value:"Usage",id:"usage",level:2},{value:"Get Question Usage",id:"get-question-usage",level:3},{value:"Query Parameters",id:"query-parameters-2",level:4},{value:"Response",id:"response-6",level:4},{value:"Error Responses",id:"error-responses",level:2},{value:"Rate Limit",id:"rate-limit",level:3},{value:"Question Limit",id:"question-limit",level:3},{value:"Invalid Question",id:"invalid-question",level:3},{value:"Rate Limits",id:"rate-limits",level:2},{value:"Webhooks",id:"webhooks",level:2},{value:"Event Types",id:"event-types",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"lens-api-endpoints",children:"LENS API Endpoints"})}),"\n",(0,r.jsx)(n.p,{children:"Access LENS features programmatically via the REST API."}),"\n",(0,r.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(n.p,{children:"All LENS endpoints require authentication via Bearer token:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \\\n  https://app.sealmetrics.com/api/lens/...\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/api/authentication",children:"Authentication"})," for details on obtaining tokens."]}),"\n",(0,r.jsx)(n.h2,{id:"endpoints-overview",children:"Endpoints Overview"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Method"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/chat"})}),(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:"Send a question to the AI assistant"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/anomalies"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"List detected anomalies"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/anomalies/{id}"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"Get anomaly details"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/anomalies/{id}/acknowledge"})}),(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:"Acknowledge an anomaly"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/rules"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"List detection rules"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/rules/{id}"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"Get rule details"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/rules"})}),(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:"Create custom rule"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/rules/{id}"})}),(0,r.jsx)(n.td,{children:"PATCH"}),(0,r.jsx)(n.td,{children:"Update a rule"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/reports"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"List generated reports"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/usage"})}),(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"Get question usage stats"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ai-assistant",children:"AI Assistant"}),"\n",(0,r.jsx)(n.h3,{id:"send-a-question",children:"Send a Question"}),"\n",(0,r.jsx)(n.p,{children:"Ask the LENS AI assistant a question about your data."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/lens/chat\n"})}),"\n",(0,r.jsx)(n.h4,{id:"request-body",children:"Request Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "account_id": "acc_123456",\n  "question": "Why did conversions drop last week?",\n  "context": {\n    "date_range": "last_7_days",\n    "segments": ["mobile"]\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"account_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Account to query"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"question"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Natural language question"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"context.date_range"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Date range context"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"context.segments"})}),(0,r.jsx)(n.td,{children:"array"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Segments to focus on"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"conversation_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Continue existing conversation"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"response",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": {\n    "answer": "Your conversions dropped 23% last week (156 \u2192 120). The main factors were:\\n\\n1. Google Ads traffic decreased 35%\\n2. Mobile conversion rate dropped from 2.1% to 1.4%\\n\\nRecommended actions:\\n\u2022 Review Google Ads budget\\n\u2022 Investigate mobile experience",\n    "conversation_id": "conv_abc123",\n    "metrics_referenced": [\n      {"name": "conversions", "value": 120, "change": -23},\n      {"name": "conversion_rate_mobile", "value": 1.4, "change": -33}\n    ],\n    "confidence": 0.89,\n    "follow_ups": [\n      "Which traffic sources had the biggest CR drop?",\n      "When exactly did the drop start?",\n      "How does this compare to last year?"\n    ]\n  },\n  "usage": {\n    "questions_used": 128,\n    "questions_limit": 200,\n    "questions_remaining": 72\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://app.sealmetrics.com/api/lens/chat \\\n  -H "Authorization: Bearer YOUR_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "account_id": "acc_123456",\n    "question": "What were my top traffic sources last week?"\n  }\'\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"anomalies",children:"Anomalies"}),"\n",(0,r.jsx)(n.h3,{id:"list-anomalies",children:"List Anomalies"}),"\n",(0,r.jsx)(n.p,{children:"Get detected anomalies for an account."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET /api/lens/anomalies\n"})}),"\n",(0,r.jsx)(n.h4,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"account_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"Account ID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"date_range"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Filter by date range"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"severity"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsxs)(n.td,{children:["Filter by severity: ",(0,r.jsx)(n.code,{children:"critical"}),", ",(0,r.jsx)(n.code,{children:"high"}),", ",(0,r.jsx)(n.code,{children:"medium"}),", ",(0,r.jsx)(n.code,{children:"low"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"status"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsxs)(n.td,{children:["Filter by status: ",(0,r.jsx)(n.code,{children:"open"}),", ",(0,r.jsx)(n.code,{children:"acknowledged"}),", ",(0,r.jsx)(n.code,{children:"dismissed"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rule_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Filter by specific rule"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"limit"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Max results (default: 50)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"offset"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"Pagination offset"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"response-1",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": [\n    {\n      "id": "anom_abc123",\n      "rule_id": "conversion_rate_drop",\n      "rule_name": "Conversion Rate Drop",\n      "severity": "critical",\n      "status": "open",\n      "detected_at": "2024-01-15T14:32:00Z",\n      "metric": {\n        "name": "conversion_rate",\n        "current_value": 0.012,\n        "baseline_value": 0.0185,\n        "change_percentage": -35.1\n      },\n      "segments": {\n        "device": {"mobile": -42, "desktop": -21}\n      }\n    }\n  ],\n  "pagination": {\n    "total": 23,\n    "limit": 50,\n    "offset": 0\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-anomaly-details",children:"Get Anomaly Details"}),"\n",(0,r.jsx)(n.p,{children:"Get detailed information about a specific anomaly."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET /api/lens/anomalies/{anomaly_id}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"response-2",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": {\n    "id": "anom_abc123",\n    "rule_id": "conversion_rate_drop",\n    "rule_name": "Conversion Rate Drop",\n    "severity": "critical",\n    "status": "open",\n    "detected_at": "2024-01-15T14:32:00Z",\n    "metric": {\n      "name": "conversion_rate",\n      "current_value": 0.012,\n      "baseline_value": 0.0185,\n      "change_percentage": -35.1,\n      "time_series": [\n        {"date": "2024-01-09", "value": 0.019},\n        {"date": "2024-01-10", "value": 0.018},\n        {"date": "2024-01-11", "value": 0.017},\n        {"date": "2024-01-12", "value": 0.015},\n        {"date": "2024-01-13", "value": 0.014},\n        {"date": "2024-01-14", "value": 0.013},\n        {"date": "2024-01-15", "value": 0.012}\n      ]\n    },\n    "segments": {\n      "device": {\n        "mobile": {"current": 0.008, "baseline": 0.014, "change": -42},\n        "desktop": {"current": 0.015, "baseline": 0.019, "change": -21}\n      },\n      "source": {\n        "google_ads": {"current": 0.010, "baseline": 0.016, "change": -38},\n        "organic": {"current": 0.013, "baseline": 0.017, "change": -24}\n      }\n    },\n    "ai_analysis": "The conversion rate drop correlates with a 200ms increase in mobile page load time, particularly affecting the checkout flow.",\n    "recommended_actions": [\n      "Investigate mobile page performance",\n      "Check recent deployments affecting checkout",\n      "Review mobile-specific conversion funnel"\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"acknowledge-anomaly",children:"Acknowledge Anomaly"}),"\n",(0,r.jsx)(n.p,{children:"Mark an anomaly as acknowledged."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/lens/anomalies/{anomaly_id}/acknowledge\n"})}),"\n",(0,r.jsx)(n.h4,{id:"request-body-1",children:"Request Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "note": "Investigating with engineering team"\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"response-3",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": {\n    "id": "anom_abc123",\n    "status": "acknowledged",\n    "acknowledged_at": "2024-01-15T15:00:00Z",\n    "acknowledged_by": "user@company.com",\n    "note": "Investigating with engineering team"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"dismiss-anomaly",children:"Dismiss Anomaly"}),"\n",(0,r.jsx)(n.p,{children:"Mark an anomaly as dismissed (false positive)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/lens/anomalies/{anomaly_id}/dismiss\n"})}),"\n",(0,r.jsx)(n.h4,{id:"request-body-2",children:"Request Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "reason": "expected_change",\n  "note": "Planned site maintenance caused temporary drop"\n}\n'})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Reason"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"expected_change"})}),(0,r.jsx)(n.td,{children:"Known change or event"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false_positive"})}),(0,r.jsx)(n.td,{children:"Detection was incorrect"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"not_actionable"})}),(0,r.jsx)(n.td,{children:"True but no action needed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"other"})}),(0,r.jsx)(n.td,{children:"Other reason (provide note)"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"rules",children:"Rules"}),"\n",(0,r.jsx)(n.h3,{id:"list-rules",children:"List Rules"}),"\n",(0,r.jsx)(n.p,{children:"Get all detection rules for an account."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET /api/lens/rules\n"})}),"\n",(0,r.jsx)(n.h4,{id:"query-parameters-1",children:"Query Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"account_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Account ID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"category"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Filter by category"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enabled"})}),(0,r.jsx)(n.td,{children:"boolean"}),(0,r.jsx)(n.td,{children:"Filter by enabled status"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"response-4",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": [\n    {\n      "id": "conversion_rate_drop",\n      "name": "Conversion Rate Drop",\n      "category": "conversions",\n      "type": "system",\n      "enabled": true,\n      "threshold": {\n        "direction": "decrease",\n        "percentage": 20\n      },\n      "last_triggered": "2024-01-15T14:32:00Z",\n      "trigger_count_30d": 3\n    },\n    {\n      "id": "custom_rule_001",\n      "name": "High-Value Order Drop",\n      "category": "custom",\n      "type": "custom",\n      "enabled": true,\n      "threshold": {\n        "direction": "decrease",\n        "percentage": 30\n      },\n      "last_triggered": null,\n      "trigger_count_30d": 0\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"create-custom-rule",children:"Create Custom Rule"}),"\n",(0,r.jsx)(n.p,{children:"Create a new custom detection rule."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/lens/rules\n"})}),"\n",(0,r.jsx)(n.h4,{id:"request-body-3",children:"Request Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "account_id": "acc_123456",\n  "name": "High-Value Orders Drop",\n  "description": "Alert when orders over \u20ac500 decrease",\n  "metric": {\n    "type": "count",\n    "event": "conversion",\n    "filters": [\n      {"field": "amount", "operator": "greater_than", "value": 500}\n    ]\n  },\n  "comparison": {\n    "type": "vs_previous_7_days"\n  },\n  "threshold": {\n    "direction": "decrease",\n    "percentage": 30\n  },\n  "alert": {\n    "severity": "high",\n    "cooldown_hours": 8,\n    "channels": ["email", "slack"]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"response-5",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": {\n    "id": "custom_rule_002",\n    "name": "High-Value Orders Drop",\n    "created_at": "2024-01-15T16:00:00Z",\n    "enabled": true\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"update-rule",children:"Update Rule"}),"\n",(0,r.jsx)(n.p,{children:"Update an existing rule (enable/disable, change threshold)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"PATCH /api/lens/rules/{rule_id}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"request-body-4",children:"Request Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "enabled": false,\n  "threshold": {\n    "percentage": 25\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"get-question-usage",children:"Get Question Usage"}),"\n",(0,r.jsx)(n.p,{children:"Get LENS AI question usage statistics."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET /api/lens/usage\n"})}),"\n",(0,r.jsx)(n.h4,{id:"query-parameters-2",children:"Query Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"account_id"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Account ID"})]})})]}),"\n",(0,r.jsx)(n.h4,{id:"response-6",children:"Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "ok",\n  "data": {\n    "period": {\n      "start": "2024-01-01",\n      "end": "2024-01-31"\n    },\n    "questions": {\n      "limit": 200,\n      "used": 127,\n      "remaining": 73\n    },\n    "daily_usage": [\n      {"date": "2024-01-15", "count": 12},\n      {"date": "2024-01-14", "count": 8},\n      {"date": "2024-01-13", "count": 5}\n    ],\n    "by_user": [\n      {"email": "analyst@company.com", "count": 85},\n      {"email": "manager@company.com", "count": 42}\n    ],\n    "overage": {\n      "count": 0,\n      "cost": 0\n    },\n    "resets_at": "2024-02-01T00:00:00Z"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"error-responses",children:"Error Responses"}),"\n",(0,r.jsx)(n.h3,{id:"rate-limit",children:"Rate Limit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "error",\n  "error": {\n    "code": "RATE_LIMIT_EXCEEDED",\n    "message": "Too many requests to LENS API",\n    "retry_after": 60\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"question-limit",children:"Question Limit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "error",\n  "error": {\n    "code": "QUESTION_LIMIT_EXCEEDED",\n    "message": "Monthly question limit reached",\n    "limit": 200,\n    "used": 200,\n    "resets_at": "2024-02-01T00:00:00Z",\n    "overage_available": true,\n    "overage_rate": 0.40\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"invalid-question",children:"Invalid Question"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "error",\n  "error": {\n    "code": "INVALID_QUESTION",\n    "message": "Question is too vague or cannot be answered with available data",\n    "suggestions": [\n      "Try being more specific about the time period",\n      "Specify which metric you\'re interested in",\n      "Add context about segments or filters"\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"rate-limits",children:"Rate Limits"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Endpoint"}),(0,r.jsx)(n.th,{children:"Rate Limit"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/chat"})}),(0,r.jsx)(n.td,{children:"10 requests/minute"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/anomalies"})}),(0,r.jsx)(n.td,{children:"60 requests/minute"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/rules"})}),(0,r.jsx)(n.td,{children:"30 requests/minute"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/lens/usage"})}),(0,r.jsx)(n.td,{children:"10 requests/minute"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Rate limit headers are included in all responses:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"X-RateLimit-Limit"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"X-RateLimit-Remaining"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"X-RateLimit-Reset"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"webhooks",children:"Webhooks"}),"\n",(0,r.jsxs)(n.p,{children:["Configure webhooks to receive LENS events. See ",(0,r.jsx)(n.a,{href:"../reports/email-alerts#webhook-alerts",children:"Email Alerts - Webhook Section"})," for details."]}),"\n",(0,r.jsx)(n.h3,{id:"event-types",children:"Event Types"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Event"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"anomaly.detected"})}),(0,r.jsx)(n.td,{children:"New anomaly detected"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"anomaly.resolved"})}),(0,r.jsx)(n.td,{children:"Anomaly returned to normal"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"report.generated"})}),(0,r.jsx)(n.td,{children:"Scheduled report ready"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"question.answered"})}),(0,r.jsx)(n.td,{children:"AI question answered"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(96540);const r={},d=i.createContext(r);function t(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);