"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2701],{15042:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"api/bigquery","title":"BigQuery Integration","description":"Export analytics data to Google BigQuery for advanced analysis.","source":"@site/docs/api/bigquery.mdx","sourceDirName":"api","slug":"/api/bigquery","permalink":"/api/bigquery","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"sidebar_position":15,"title":"BigQuery Integration","description":"Export analytics data to Google BigQuery for advanced analysis."},"sidebar":"tutorialSidebar","previous":{"title":"Exports","permalink":"/api/exports"},"next":{"title":"IP Allowlist","permalink":"/api/ip-allowlist"}}');var t=s(74848),r=s(28453);const d={sidebar_position:15,title:"BigQuery Integration",description:"Export analytics data to Google BigQuery for advanced analysis."},a="BigQuery Integration",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Setup Flow",id:"setup-flow",level:2},{value:"Configure Integration",id:"configure-integration",level:2},{value:"Create Integration",id:"create-integration",level:3},{value:"Get Integration",id:"get-integration",level:3},{value:"Update Integration",id:"update-integration",level:3},{value:"Delete Integration",id:"delete-integration",level:3},{value:"Initial Setup",id:"initial-setup",level:2},{value:"Setup Errors",id:"setup-errors",level:3},{value:"Sync Operations",id:"sync-operations",level:2},{value:"Trigger Manual Sync",id:"trigger-manual-sync",level:3},{value:"Backfill Historical Data",id:"backfill-historical-data",level:3},{value:"Retry Failed Sync",id:"retry-failed-sync",level:3},{value:"Sync Logs",id:"sync-logs",level:2},{value:"List Sync Logs",id:"list-sync-logs",level:3},{value:"Sync Status Values",id:"sync-status-values",level:3},{value:"Get Sync Log Detail",id:"get-sync-log-detail",level:3},{value:"Schema Information",id:"schema-information",level:2},{value:"Get Table Schema",id:"get-table-schema",level:3},{value:"Required Permissions",id:"required-permissions",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Python - Setup and Sync",id:"python---setup-and-sync",level:3},{value:"JavaScript - Monitor Sync",id:"javascript---monitor-sync",level:3},{value:"Error Codes",id:"error-codes",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Use Dedicated Service Account",id:"1-use-dedicated-service-account",level:3},{value:"2. Limit Dataset Permissions",id:"2-limit-dataset-permissions",level:3},{value:"3. Schedule Syncs During Off-Peak",id:"3-schedule-syncs-during-off-peak",level:3},{value:"4. Monitor Sync Logs",id:"4-monitor-sync-logs",level:3}];function o(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"bigquery-integration",children:"BigQuery Integration"})}),"\n",(0,t.jsx)(n.p,{children:"Export Sealmetrics analytics data to Google BigQuery for advanced analysis, custom reporting, and data warehousing."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The BigQuery integration allows you to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automatically sync analytics data to your BigQuery dataset"}),"\n",(0,t.jsx)(n.li,{children:"Run custom SQL queries on your traffic and conversion data"}),"\n",(0,t.jsx)(n.li,{children:"Integrate with BI tools like Looker, Data Studio, or Tableau"}),"\n",(0,t.jsx)(n.li,{children:"Perform advanced analysis not available in the dashboard"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Base path:"})," ",(0,t.jsx)(n.code,{children:"/integrations/bigquery"})]}),"\n",(0,t.jsx)(n.admonition,{title:"Enterprise Feature",type:"note",children:(0,t.jsx)(n.p,{children:"BigQuery integration is available on Enterprise plans only."})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"setup-flow",children:"Setup Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create a Google Cloud service account with BigQuery permissions"}),"\n",(0,t.jsx)(n.li,{children:"Configure the integration with your credentials"}),"\n",(0,t.jsx)(n.li,{children:"Run initial setup to create tables"}),"\n",(0,t.jsx)(n.li,{children:"Enable automatic sync or trigger manual syncs"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configure-integration",children:"Configure Integration"}),"\n",(0,t.jsx)(n.h3,{id:"create-integration",children:"Create Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /integrations/bigquery?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "project_id": "my-gcp-project",\n  "dataset_id": "sealmetrics_data",\n  "credentials_json": "{...service account JSON...}",\n  "sync_frequency": "daily",\n  "sync_hour_utc": 3,\n  "enabled": true,\n  "tables": ["sessions", "pageviews", "conversions"]\n}\n'})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"project_id"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Google Cloud project ID"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dataset_id"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"BigQuery dataset name"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"credentials_json"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Service account JSON key"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sync_frequency"})}),(0,t.jsx)(n.td,{children:"enum"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"hourly"}),", ",(0,t.jsx)(n.code,{children:"daily"})," (default), ",(0,t.jsx)(n.code,{children:"weekly"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sync_hour_utc"})}),(0,t.jsx)(n.td,{children:"integer"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Hour (0-23) to run daily syncs (default: 3)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"enabled"})}),(0,t.jsx)(n.td,{children:"boolean"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Enable automatic sync (default: true)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"tables"})}),(0,t.jsx)(n.td,{children:"string[]"}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Tables to sync (default: all)"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response (201 Created):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "id": 1,\n    "site_id": "my-site",\n    "project_id": "my-gcp-project",\n    "dataset_id": "sealmetrics_data",\n    "sync_frequency": "daily",\n    "sync_hour_utc": 3,\n    "enabled": true,\n    "tables": ["sessions", "pageviews", "conversions"],\n    "status": "pending_setup",\n    "last_sync_at": null,\n    "next_sync_at": "2025-01-11T03:00:00Z",\n    "created_at": "2025-01-10T14:30:00Z"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"get-integration",children:"Get Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /integrations/bigquery?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "id": 1,\n    "site_id": "my-site",\n    "project_id": "my-gcp-project",\n    "dataset_id": "sealmetrics_data",\n    "sync_frequency": "daily",\n    "sync_hour_utc": 3,\n    "enabled": true,\n    "tables": ["sessions", "pageviews", "conversions"],\n    "status": "active",\n    "last_sync_at": "2025-01-10T03:00:00Z",\n    "last_sync_status": "success",\n    "last_sync_rows": 15420,\n    "next_sync_at": "2025-01-11T03:00:00Z",\n    "created_at": "2025-01-01T10:00:00Z"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"update-integration",children:"Update Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"PATCH /integrations/bigquery?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "sync_frequency": "hourly",\n  "enabled": true,\n  "tables": ["sessions", "pageviews", "conversions", "microconversions"]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"All fields are optional. Only provided fields are updated."}),"\n",(0,t.jsx)(n.h3,{id:"delete-integration",children:"Delete Integration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"DELETE /integrations/bigquery?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Removes the integration configuration. Does not delete data from BigQuery."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Response:"})," 204 No Content"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,t.jsx)(n.p,{children:"After configuring the integration, run setup to create BigQuery tables."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /integrations/bigquery/setup?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This endpoint:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Validates credentials and permissions"}),"\n",(0,t.jsx)(n.li,{children:"Creates the dataset if it doesn't exist"}),"\n",(0,t.jsx)(n.li,{children:"Creates tables with the correct schema"}),"\n",(0,t.jsx)(n.li,{children:"Marks integration as ready for sync"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "status": "success",\n    "dataset_created": false,\n    "tables_created": ["sessions", "pageviews", "conversions"],\n    "message": "BigQuery setup completed successfully"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"setup-errors",children:"Setup Errors"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Error"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"invalid_credentials"})}),(0,t.jsx)(n.td,{children:"Service account JSON is invalid"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"insufficient_permissions"})}),(0,t.jsx)(n.td,{children:"Service account lacks required permissions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dataset_exists_different_project"})}),(0,t.jsx)(n.td,{children:"Dataset exists in another project"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"quota_exceeded"})}),(0,t.jsx)(n.td,{children:"BigQuery quota exceeded"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"sync-operations",children:"Sync Operations"}),"\n",(0,t.jsx)(n.h3,{id:"trigger-manual-sync",children:"Trigger Manual Sync"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /integrations/bigquery/sync?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Trigger an immediate sync of recent data."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body (optional):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "date_from": "2025-01-01",\n  "date_to": "2025-01-10"\n}\n'})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"date_from"})}),(0,t.jsx)(n.td,{children:"date"}),(0,t.jsx)(n.td,{children:"Start date (default: last sync date)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"date_to"})}),(0,t.jsx)(n.td,{children:"date"}),(0,t.jsx)(n.td,{children:"End date (default: yesterday)"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "sync_id": "550e8400-e29b-41d4-a716-446655440000",\n    "status": "started",\n    "date_from": "2025-01-01",\n    "date_to": "2025-01-10",\n    "estimated_rows": 45000,\n    "message": "Sync started. Check logs for progress."\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"backfill-historical-data",children:"Backfill Historical Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /integrations/bigquery/backfill?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sync historical data that may be missing."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "date_from": "2024-01-01",\n  "date_to": "2024-12-31",\n  "tables": ["sessions", "pageviews"]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "backfill_id": "550e8400-e29b-41d4-a716-446655440001",\n    "status": "started",\n    "date_from": "2024-01-01",\n    "date_to": "2024-12-31",\n    "tables": ["sessions", "pageviews"],\n    "estimated_rows": 1250000,\n    "message": "Backfill started. This may take several minutes."\n  }\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"Backfills for large date ranges may take significant time and consume BigQuery quota."})}),"\n",(0,t.jsx)(n.h3,{id:"retry-failed-sync",children:"Retry Failed Sync"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"POST /integrations/bigquery/retry/{log_id}?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Retry a failed sync operation."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "sync_id": "550e8400-e29b-41d4-a716-446655440002",\n    "status": "started",\n    "original_log_id": 123,\n    "message": "Retry started"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"sync-logs",children:"Sync Logs"}),"\n",(0,t.jsx)(n.h3,{id:"list-sync-logs",children:"List Sync Logs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /integrations/bigquery/logs?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query Parameters:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"limit"})}),(0,t.jsx)(n.td,{children:"integer"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"20"})}),(0,t.jsx)(n.td,{children:"Max results (1-100)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"offset"})}),(0,t.jsx)(n.td,{children:"integer"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0"})}),(0,t.jsx)(n.td,{children:"Skip N results"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"status"})}),(0,t.jsx)(n.td,{children:"enum"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Filter by status"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "logs": [\n      {\n        "id": 123,\n        "sync_id": "550e8400-e29b-41d4-a716-446655440000",\n        "type": "sync",\n        "status": "success",\n        "date_from": "2025-01-09",\n        "date_to": "2025-01-09",\n        "tables_synced": ["sessions", "pageviews", "conversions"],\n        "rows_synced": 15420,\n        "bytes_processed": 4500000,\n        "duration_seconds": 45,\n        "started_at": "2025-01-10T03:00:00Z",\n        "completed_at": "2025-01-10T03:00:45Z"\n      }\n    ],\n    "total": 30\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"sync-status-values",children:"Sync Status Values"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Status"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"pending"})}),(0,t.jsx)(n.td,{children:"Sync queued"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"running"})}),(0,t.jsx)(n.td,{children:"Sync in progress"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"success"})}),(0,t.jsx)(n.td,{children:"Sync completed successfully"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"partial"})}),(0,t.jsx)(n.td,{children:"Some tables failed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"failed"})}),(0,t.jsx)(n.td,{children:"Sync failed completely"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"get-sync-log-detail",children:"Get Sync Log Detail"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /integrations/bigquery/logs/{log_id}?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Returns detailed information including per-table results and error messages."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"schema-information",children:"Schema Information"}),"\n",(0,t.jsx)(n.h3,{id:"get-table-schema",children:"Get Table Schema"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /integrations/bigquery/schema?site_id={site_id}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the schema for all available tables."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "tables": {\n      "sessions": {\n        "description": "Session-level data",\n        "fields": [\n          {"name": "session_id", "type": "STRING", "description": "Unique session identifier"},\n          {"name": "visitor_id", "type": "STRING", "description": "Visitor identifier"},\n          {"name": "started_at", "type": "TIMESTAMP", "description": "Session start time"},\n          {"name": "utm_source", "type": "STRING", "description": "UTM source"},\n          {"name": "utm_medium", "type": "STRING", "description": "UTM medium"},\n          {"name": "utm_campaign", "type": "STRING", "description": "UTM campaign"},\n          {"name": "country", "type": "STRING", "description": "Country code (ISO)"},\n          {"name": "device_type", "type": "STRING", "description": "Device type"},\n          {"name": "browser", "type": "STRING", "description": "Browser name"},\n          {"name": "os", "type": "STRING", "description": "Operating system"},\n          {"name": "landing_page", "type": "STRING", "description": "Entry page path"},\n          {"name": "page_views", "type": "INTEGER", "description": "Pages viewed"},\n          {"name": "duration_seconds", "type": "INTEGER", "description": "Session duration"},\n          {"name": "is_engaged", "type": "BOOLEAN", "description": "Engaged session flag"},\n          {"name": "is_bounce", "type": "BOOLEAN", "description": "Bounce flag"}\n        ]\n      },\n      "pageviews": {\n        "description": "Page view events",\n        "fields": [\n          {"name": "pageview_id", "type": "STRING", "description": "Unique pageview identifier"},\n          {"name": "session_id", "type": "STRING", "description": "Session identifier"},\n          {"name": "path", "type": "STRING", "description": "Page path"},\n          {"name": "title", "type": "STRING", "description": "Page title"},\n          {"name": "viewed_at", "type": "TIMESTAMP", "description": "View timestamp"},\n          {"name": "time_on_page", "type": "INTEGER", "description": "Seconds on page"}\n        ]\n      },\n      "conversions": {\n        "description": "Conversion events",\n        "fields": [\n          {"name": "conversion_id", "type": "STRING", "description": "Unique conversion identifier"},\n          {"name": "session_id", "type": "STRING", "description": "Session identifier"},\n          {"name": "conversion_type", "type": "STRING", "description": "Conversion type"},\n          {"name": "value", "type": "FLOAT", "description": "Conversion value"},\n          {"name": "currency", "type": "STRING", "description": "Currency code"},\n          {"name": "converted_at", "type": "TIMESTAMP", "description": "Conversion timestamp"}\n        ]\n      },\n      "microconversions": {\n        "description": "Microconversion events",\n        "fields": [\n          {"name": "event_id", "type": "STRING", "description": "Unique event identifier"},\n          {"name": "session_id", "type": "STRING", "description": "Session identifier"},\n          {"name": "event_type", "type": "STRING", "description": "Event type"},\n          {"name": "event_data", "type": "JSON", "description": "Event metadata"},\n          {"name": "occurred_at", "type": "TIMESTAMP", "description": "Event timestamp"}\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"required-permissions",children:"Required Permissions"}),"\n",(0,t.jsx)(n.p,{children:"The service account needs these BigQuery permissions:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Permission"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.datasets.create"})}),(0,t.jsx)(n.td,{children:"Create dataset (if needed)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.datasets.get"})}),(0,t.jsx)(n.td,{children:"Read dataset metadata"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.tables.create"})}),(0,t.jsx)(n.td,{children:"Create tables"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.tables.get"})}),(0,t.jsx)(n.td,{children:"Read table metadata"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.tables.updateData"})}),(0,t.jsx)(n.td,{children:"Insert data"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bigquery.jobs.create"})}),(0,t.jsx)(n.td,{children:"Run load jobs"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Recommended Role:"})," ",(0,t.jsx)(n.code,{children:"roles/bigquery.dataEditor"})," on the dataset."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,t.jsx)(n.h3,{id:"python---setup-and-sync",children:"Python - Setup and Sync"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import requests\nimport json\n\nAPI_KEY = "sm_your_api_key"\nBASE_URL = "https://api.sealmetrics.com/api/v1"\nSITE_ID = "my-site"\n\ndef setup_bigquery(project_id, dataset_id, credentials_path):\n    """Configure BigQuery integration."""\n\n    with open(credentials_path) as f:\n        credentials = f.read()\n\n    # Create integration\n    response = requests.post(\n        f"{BASE_URL}/integrations/bigquery",\n        headers={"X-API-Key": API_KEY},\n        params={"site_id": SITE_ID},\n        json={\n            "project_id": project_id,\n            "dataset_id": dataset_id,\n            "credentials_json": credentials,\n            "sync_frequency": "daily",\n            "sync_hour_utc": 3\n        }\n    )\n    response.raise_for_status()\n\n    # Run setup\n    setup_response = requests.post(\n        f"{BASE_URL}/integrations/bigquery/setup",\n        headers={"X-API-Key": API_KEY},\n        params={"site_id": SITE_ID}\n    )\n    setup_response.raise_for_status()\n\n    return setup_response.json()\n\n\ndef trigger_backfill(date_from, date_to):\n    """Backfill historical data."""\n    response = requests.post(\n        f"{BASE_URL}/integrations/bigquery/backfill",\n        headers={"X-API-Key": API_KEY},\n        params={"site_id": SITE_ID},\n        json={\n            "date_from": date_from,\n            "date_to": date_to\n        }\n    )\n    response.raise_for_status()\n    return response.json()\n\n\ndef check_sync_status(sync_id):\n    """Check status of a sync operation."""\n    response = requests.get(\n        f"{BASE_URL}/integrations/bigquery/logs",\n        headers={"X-API-Key": API_KEY},\n        params={"site_id": SITE_ID}\n    )\n\n    for log in response.json()["data"]["logs"]:\n        if log["sync_id"] == sync_id:\n            return log["status"]\n\n    return "not_found"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"javascript---monitor-sync",children:"JavaScript - Monitor Sync"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function monitorSync(syncId) {\n  const checkStatus = async () => {\n    const response = await fetch(\n      `${BASE_URL}/integrations/bigquery/logs?site_id=${SITE_ID}`,\n      {\n        headers: { 'X-API-Key': API_KEY }\n      }\n    );\n\n    const { data } = await response.json();\n    const log = data.logs.find(l => l.sync_id === syncId);\n\n    return log?.status || 'not_found';\n  };\n\n  let status = await checkStatus();\n\n  while (status === 'pending' || status === 'running') {\n    await new Promise(r => setTimeout(r, 5000)); // Wait 5s\n    status = await checkStatus();\n    console.log(`Sync status: ${status}`);\n  }\n\n  return status;\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"error-codes",children:"Error Codes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"HTTP Code"}),(0,t.jsx)(n.th,{children:"Error"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"400"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"invalid_credentials"})}),(0,t.jsx)(n.td,{children:"Service account JSON is malformed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"401"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"authentication_failed"})}),(0,t.jsx)(n.td,{children:"Credentials rejected by Google"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"403"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"insufficient_permissions"})}),(0,t.jsx)(n.td,{children:"Missing required BigQuery permissions"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"404"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"integration_not_found"})}),(0,t.jsx)(n.td,{children:"No BigQuery integration configured"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"409"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sync_in_progress"})}),(0,t.jsx)(n.td,{children:"Another sync is already running"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"429"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"quota_exceeded"})}),(0,t.jsx)(n.td,{children:"BigQuery API quota exceeded"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"1-use-dedicated-service-account",children:"1. Use Dedicated Service Account"}),"\n",(0,t.jsx)(n.p,{children:"Create a service account specifically for Sealmetrics:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'gcloud iam service-accounts create sealmetrics-sync \\\n  --display-name="Sealmetrics BigQuery Sync"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-limit-dataset-permissions",children:"2. Limit Dataset Permissions"}),"\n",(0,t.jsx)(n.p,{children:"Grant permissions only on the specific dataset:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'bq add-iam-policy-binding \\\n  --member="serviceAccount:sealmetrics-sync@project.iam.gserviceaccount.com" \\\n  --role="roles/bigquery.dataEditor" \\\n  project:sealmetrics_data\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-schedule-syncs-during-off-peak",children:"3. Schedule Syncs During Off-Peak"}),"\n",(0,t.jsxs)(n.p,{children:["Configure ",(0,t.jsx)(n.code,{children:"sync_hour_utc"})," to run during low-traffic hours to minimize impact."]}),"\n",(0,t.jsx)(n.h3,{id:"4-monitor-sync-logs",children:"4. Monitor Sync Logs"}),"\n",(0,t.jsxs)(n.p,{children:["Regularly check sync logs for failures and set up alerts for ",(0,t.jsx)(n.code,{children:"failed"})," status."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>a});var i=s(96540);const t={},r=i.createContext(t);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);